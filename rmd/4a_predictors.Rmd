---
title: "4a_predictors"
author: "Brit C. Henderson"
date: '2022-07-08'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Open Intro County Complete Data Set
Source:https://www.ers.usda.gov/data-products/county-level-data-sets/download-data/  

Then: https://www.openintro.org/data/?data=county_complete
The data prior to 2011 was from http://census.gov, though the exact page it came from is no longer available.

More recent data comes from the following sources.

*Downloaded via the tidycensus R package.
*Download links for spreadsheets were found on https://www.ers.usda.gov/data-products/county-level-data-sets/download-data
*Unemployment - Bureau of Labor Statistics - LAUS data - https://www.bls.gov/lau/.
*Median Household Income - Census Bureau - Small Area Income and Poverty Estimates (SAIPE) data.
*The original data table was prepared by USDA, Economic Research Service.
*Census Bureau.
*2012-16 American Community Survey 5-yr average.
*The original data table was prepared by USDA, Economic Research Service.
*Tim Parker (tparker at ers.usda.gov) is the contact for much of the new data incorporated into this data set.
```{r}
library(tidyverse)
#Read in data and pick 6 to 10 factors
dat <- read_csv(here::here("raw/CountyPredictors", "county_complete.csv"))
dat2 <- dat %>% 
  select(fips, state, name, pop2017, some_college_2017, hs_grad_2017, broadband_2017, median_household_income_2017, poverty_2017, unemployment_rate_2017   ) %>% 
  mutate(fips_clean = as.character(sprintf("%05d", fips)))

```

# County Business Patterns Data: 2019
https://www.census.gov/data/datasets/2019/econ/cbp/2019-cbp.html
Reading in data and selecting naics codes corresponding to commercial banks, savings institutions, and credit unions
```{r}

dat.cbp2019 <- read_csv(here::here("raw/CountyPredictors", "cbp19co.txt"))
dat2.cbp2019 <- dat.cbp2019 %>% 
  filter(naics %in% c("522110","522120" ,"522130")) %>% 
  select( fipstate, fipscty, est) %>% 
  mutate(fips_clean = paste(fipstate, fipscty, sep = "")) %>% 
  group_by(fips_clean) %>% 
  summarise(nbanks = sum(est))

```

# County Income Inequaltiy
https://www.countyhealthrankings.org/app/colorado/2017/measure/factors/44/datasource

NOTE: May have to download separate data set for each state...

#Merge County predictors with other county-level file
```{r}
# reading in geo file
analysis.geo1 <- readRDS(here::here("rda","analysis.geo.rds"))

#put all data frames into list
df_list <- list(analysis.geo1, dat2, dat2.cbp2019)

#merge all data frames in list
analysis.dat.combo <- df_list %>% reduce(full_join, by='fips_clean')



```

