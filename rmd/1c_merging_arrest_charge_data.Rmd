---
title: "1c_Combining Arrest Data"
author: "Brit Henderson"
date: "Last Updated: `r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

# Objective
Combine the different charge types into one arrest counts file
```{r directories}
rawdatdir <- "/data/share/xproject/Training/Practice/henderson/Dissertation/raw"
rdadir <- "/data/share/xproject/Training/Practice/henderson/Dissertation/rda/Intermediate"

```

```{r functions}

```

```{r packages}
# # Import packages
library(Hmisc)
library(tidyverse) # suite of packages in for manipulating/tidying/visualizing, etc. data
library(lubridate) # manipulating dates
library(readxl)  # read in excel files
library(knitr) # for RMD formatting
library(kableExtra) # to output tables as images
library(fastDummies) # easy creation of dummy variables 



```


#Load the data sets
```{r data}
dat.index <- readRDS(here::here("rda/Intermediate/int_index.rds"))




```


#Merge with county fips crosswalk file
```{r}
#Read in county fips crosswalk file
fips_xwalk <- read.csv(here::here("raw/Census Data/FIPS_code_xwalk.csv"), colClasses = c(FIPS = "character"))

# Add leading zeros to Fips codes in xwalk
fips_xwalk$fips_clean <- str_pad(fips_xwalk$FIPS, 5, pad = "0")
  #paste0("0",fips_xwalk$FIPS) - this code could be useful if everything in column needs leading zero. otherwise requires conditioning
  

#In population data set, create composite fips code variable that includes county fips code and state fips code
dat5$fips_clean <- paste(dat5$state.fips,dat5$county.fips,sep="")

dat6 <- merge(dat5,fips_xwalk,by="fips_clean", all = TRUE)
count(filter(dat6,is.na(State)==1 & is.na(state)==0))
count(filter(dat6,is.na(State)==0 & is.na(state)==1))
#count(filter(dat6,is.na(State)==0 & is.na(state)==1, !(State %in% c('PR','AS','VI','MP','GU'))))

as.data.frame(filter(dat6,is.na(State)==0 & is.na(state)==1) %>% select(fips_clean,FIPS, Name, State))  
```


#summary statistics for both data sets
```{r}
summary(dat6)
describe(dat6)
#There are 16 county-years observations that did not have any young adults
# The largest number of young adults is 1,097,486

dat6 %>% filter(is.na(State) ==1) %>%  #select(unique())
```
There are `r sum(is.na(dat5$n_young_adults)==1)` county-year observations that did not have any young adults.
There are `r count(filter(dat6,is.na(State)==1 & is.na(state)==0))` observations that are in the FIPS crosswalk but not in the population data set.
There are `r count(filter(dat6,is.na(State)==0 & is.na(state)==1))` observations that are in the population data set but not in the FIPS crosswalk. Most of these were for geographies in Puerto Rico, American Samoa, U.S. Virgin Islands, Northern Mariana Islands, and Guam. There were also
`r count(filter(dat6,is.na(State)==0 & is.na(state)==1, State = "VA")` records for Virginia and 1 record for Yellowstone National Park in Montana that did not match to any FIPS codes. This is fine.  
The largest number of young adults is 1,097,486.

#Cleaning final data set
```{r}
dat7 <- dat6 %>% select(-state,-FIPS)
```


#Save files to type rda

```{r}
save(dat4, file = file.path(rdadir, ""))
save(dat7, file = file.path(rdadir, ""))
```

