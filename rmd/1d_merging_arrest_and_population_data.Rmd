---
title: "1d_merging_arrest_and_population_data"
author: "Brit Henderson"
date: "Last Updated: `r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---
# Objective
Combine arrest counts data with population counts data
```{r directories}
readdatdir <- "/data/share/xproject/Training/Practice/henderson/Dissertation/rda"
rdadir <- "/data/share/xproject/Training/Practice/henderson/Dissertation/rda"

```

```{r functions}

```

```{r packages}
# # Import packages
library(Hmisc)
library(tidyverse) # suite of packages in for manipulating/tidying/visualizing, etc. data
library(lubridate) # manipulating dates
library(readxl)  # read in excel files
library(knitr) # for RMD formatting
library(kableExtra) # to output tables as images
library(fastDummies) # easy creation of dummy variables 



```


#Load the data sets
```{r data}
arrests <- readRDS(here::here("rda/all_arrests.rds"))
population <- load(here::here("rda/population_long.RData"))




```

# merge data sets
```{r merge}

#put all data frames into list
df_list <- list(dat.index, dat.prop, dat.drug, dat.other)      

#merge all data frames together
all.arrests <- df_list %>% reduce(full_join, 
                                  by= c("ori","ori9","year","state","country_division", "fips_place_code","agency_name","fips_state_county_code", "state_abb",
                                        "population_group","population","longitude","latitude","fips_county_code", "fips_state_code","covered_by","number_of_months_reported"))


checkdat1 <- select(all.arrests, agency_name, year, state, fips_state_county_code) %>% group_by(agency_name, year, state, fips_state_county_code) %>% 
  summarise(numrec = n())

table(checkdat1$numrec, useNA = "always")

checkdat2 <- filter(checkdat1, numrec >1)

#Removing exact duplicate observations
all.arrests2 <- all.arrests[!duplicated(all.arrests), ]

```



#summary statistics for all arrests data set
```{r stats}
summary(all.arrests)
describe(all.arrests)
glimpse(all.arrests2)
```

```{r checks}

checkdat <- all.arrests2 %>% 
  group_by(year, agency_name, fips_place_code, fips_state_county_code) %>% 
  summarise(n = n())

summary(checkdat2)

hist(checkdat2$n)
table(checkdat2$n, useNA = "always")
checkdat2 <- all.arrests2 %>% count(year, agency_name, fips_place_code, fips_state_county_code)
```




#Save files to type rda

```{r}
saveRDS(all.arrests2, file = file.path(rdadir, "all_arrests.rds"))
```

